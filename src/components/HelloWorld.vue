<template>
  <div class="hello">
    <div :class="['step', { dog: dognum == 1 }]">01</div>
    <div :class="['step', { dog: dognum == 2 }]">02</div>
    <div :class="['step', { dog: dognum == 3 }]">03</div>
    <div :class="['step', { dog: dognum == 4 }]">04</div>
    <div :class="['step', { dog: dognum == 5 }]">05</div>
    <div :class="['step', { dog: dognum == 6 }]">06</div>
    <div :class="['step', { dog: dognum == 7 }]">07</div>
    <div :class="['step', { dog: dognum == 8 }]">08</div>
    <div :class="['step', { dog: dognum == 9 }]">09</div>
    <div :class="['step', { dog: dognum == 10 }]">10</div>
    <div :class="['step', { dog: dognum == 11 }]">11</div>
    <div :class="['step', { dog: dognum == 12 }]">12</div>
    <div :class="['step', { dog: dognum == 13 }]">13</div>
    <div :class="['step', { dog: dognum == 14 }]">14</div>
    <div :class="['step', { dog: dognum == 15 }]">15</div>
    <div :class="['step', { dog: dognum == 16 }]">16</div>
    <div :class="['step', { dog: dognum == 17 }]">17</div>
    <div :class="['step', { dog: dognum == 18 }]">18</div>
    <div :class="['step', { dog: dognum == 19 }]">19</div>
    <div :class="['step', { dog: dognum == 20 }]">20</div>
    <div :class="['step', { dog: dognum == 21 }]">21</div>
    <div :class="['step', { dog: dognum == 22 }]">22</div>
    <div :class="['step', { dog: dognum == 23 }]">23</div>
    <div :class="['step', { dog: dognum == 24 }]">24</div>
    <div :class="['step', { dog: dognum == 25 }]">25</div>
    <div :class="['step', { dog: dognum == 26 }]">26</div>
    <div :class="['step', { dog: dognum == 27 }]">27</div>
    <div :class="['step', { dog: dognum == 28 }]">28</div>
    <div :class="['step', { dog: dognum == 29 }]">29</div>
    <div :class="['step', { dog: dognum == 30 }]">30</div>
    <div :class="['step', { dog: dognum == 31 }]">31</div>
    <div :class="['step', { dog: dognum == 32 }]">32</div>
    <div :class="['step', { dog: dognum == 33 }]">33</div>
    <div :class="['step', { dog: dognum == 34 }]">34</div>
    <div :class="['step', { dog: dognum == 35 }]">35</div>
    <div :class="['step', { dog: dognum == 36 }]">36</div>
    <div :class="['step', { dog: dognum == 37 }]">37</div>
    <div :class="['step', { dog: dognum == 38 }]">38</div>
    <div :class="['step', { dog: dognum == 39 }]">39</div>
    <div :class="['step', { dog: dognum == 40 }]">40</div>
    <div :class="['step', { dog: dognum == 41 }]">41</div>
    <div :class="['step', { dog: dognum == 42 }]">42</div>
    <div :class="['step', { dog: dognum == 43 }]">43</div>
    <div :class="['step', { dog: dognum == 44 }]">44</div>
    <div :class="['step', { dog: dognum == 45 }]">45</div>
    <div :class="['step', { dog: dognum == 46 }]">46</div>
    <div :class="['step', { dog: dognum == 47 }]">47</div>
    <div :class="['step', { dog: dognum == 48 }]">48</div>
    <div :class="['step', { dog: dognum == 49 }]">49</div>
    <div :class="['step', { dog: dognum == 50 }]">50</div>
    <div :class="['step', { dog: dognum == 51 }]">51</div>
    <div :class="['step', { dog: dognum == 52 }]">52</div>
    <div :class="['step', { dog: dognum == 53 }]">53</div>
    <div :class="['step', { dog: dognum == 54 }]">54</div>
    <div :class="['step', { dog: dognum == 55 }]">55</div>
    <div :class="['step', { dog: dognum == 56 }]">56</div>
    <div :class="['step', { dog: dognum == 57 }]">57</div>
    <div :class="['step', { dog: dognum == 58 }]">58</div>
    <div :class="['step', { dog: dognum == 59 }]">59</div>
    <div :class="['step', { dog: dognum == 60 }]">60</div>
    <div :class="['step', { dog: dognum == 61 }]">61</div>
    <div :class="['step', { dog: dognum == 62 }]">62</div>
    <div :class="['step', { dog: dognum == 63 }]">63</div>
    <div :class="['step', { dog: dognum == 64 }]">64</div>
    <div :class="['step', { dog: dognum == 65 }]">65</div>
    <div :class="['step', { dog: dognum == 66 }]">66</div>
    <div :class="['step', { dog: dognum == 67 }]">67</div>
    <div :class="['step', { dog: dognum == 68 }]">68</div>
    <div :class="['step', { dog: dognum == 69 }]">69</div>
    <div :class="['step', { dog: dognum == 70 }]">70</div>
    <div :class="['step', { dog: dognum == 71 }]">71</div>
    <div :class="['step', { dog: dognum == 72 }]">72</div>
    <div :class="['step', { dog: dognum == 73 }]">73</div>
    <div :class="['step', { dog: dognum == 74 }]">74</div>
    <div :class="['step', { dog: dognum == 75 }]">75</div>
    <div :class="['step', { dog: dognum == 76 }]">76</div>
    <div :class="['step', { dog: dognum == 77 }]">77</div>
    <div :class="['step', { dog: dognum == 78 }]">78</div>
    <div :class="['step', { dog: dognum == 79 }]">79</div>
    <div :class="['step', { dog: dognum == 80 }]">80</div>
    <div :class="['step', { dog: dognum == 81 }]">81</div>
    <div :class="['step', { dog: dognum == 82 }]">82</div>
    <div :class="['step', { dog: dognum == 83 }]">83</div>
    <div :class="['step', { dog: dognum == 84 }]">84</div>
    <div :class="['step', { dog: dognum == 85 }]">85</div>
    <div :class="['step', { dog: dognum == 86 }]">86</div>
    <div :class="['step', { dog: dognum == 87 }]">87</div>
    <div :class="['step', { dog: dognum == 88 }]">88</div>
    <div :class="['step', { dog: dognum == 89 }]">89</div>
    <div :class="['step', { dog: dognum == 90 }]">90</div>
    <div :class="['step', { dog: dognum == 91 }]">91</div>
    <div :class="['step', { dog: dognum == 92 }]">92</div>
    <div :class="['step', { dog: dognum == 93 }]">93</div>
    <div :class="['step', { dog: dognum == 94 }]">94</div>
    <div :class="['step', { dog: dognum == 95 }]">95</div>
    <div :class="['step', { dog: dognum == 96 }]">96</div>
    <div :class="['step', { dog: dognum == 97 }]">97</div>
    <div :class="['step', { dog: dognum == 98 }]">98</div>
    <div :class="['step', { dog: dognum == 99 }]">99</div>
    <div :class="['step', { dog: dognum == 100 }]">100</div>
    <div>当前位置： {{ dognum }}</div>
    <div>上次为第{{ times - 1 }}次投出骰子</div>
    <div v-show="times !== 1">上次掷出骰子点数：{{ stepnum }}</div>

    <button @click="set()">set</button>
    <button @click="get()">get</button>
  </div>
</template>

<script>
import { ethers, providers } from "ethers";
import Race from "../artifacts/contracts/Race.sol/Race.json";

const raceAddress = "0x1fA02b2d6A771842690194Cf62D91bdd92BfE28d";

export default {
  name: "HelloWorld",
  props: {
    msg: String,
  },

  data() {
    return {
      dog: "dog",
      dognum: null,
      stepnum: null,
      oldnum: null,
      times: 0,
    };
  },
  onload() {},
  async mounted() {
    this.get();
    console.log("providers: " + providers);
  },
  methods: {
    async requestAccount() {
      await window.ethereum.request({ method: "eth_requestAccounts" });
    },

    async get() {
      if (typeof window.ethereum !== "undefined") {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const contract = new ethers.Contract(raceAddress, Race.abi, provider);
        try {
          const data = await contract.getDognum();
          this.times = this.times + 1;
          this.oldnum = this.dognum;
          this.dognum = data;
          console.log("times: " + this.times);
          if (this.times !== 1) {
            this.stepnum = this.dognum - this.oldnum;
          }
        } catch (err) {
          console.log("Error: ", err);
        }
      }
    },

    async set() {
      let that = this;
      if (!that.dognum) return;
      if (typeof window.ethereum !== "undefined") {
        await that.requestAccount();
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();
        const contract = new ethers.Contract(raceAddress, Race.abi, signer);
        const transaction = await contract.setDogmum();
        await transaction.wait();
        that.get();
      }
    },
  },
};
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
.step {
  border: 1px solid black;
  width: 5%;
  height: 80px;
  display: inline-block;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  line-height: 50px;
}

.dog {
  background-image: url("111.png");
  background-size: contain;
  background-size: cover;
  background-size: 100% 100%;
}

h3 {
  margin: 40px 0 0;
}
ul {
  list-style-type: none;
  padding: 0;
}
li {
  display: inline-block;
  margin: 0 10px;
}
a {
  color: #42b983;
}
</style>
